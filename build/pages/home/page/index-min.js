KISSY.add("widget/tmpl/index",function(a,b){function c(a,b){function c(a,b){if(e++,a[e]){var d=a[e].replace(/\[[^\]]*\]/g,""),f=/\[([\d\w]*)\]/g.exec(a[e]);return f&&void 0!=f[1]&&b[d]&&void 0!=b[d][f[1]]?c(a,b[d][f[1]]):void 0!=b[a[e]]?c(a,b[a[e]]):-1}return void 0!=b?b:-1}var d=a.split("."),e=-1;return c(d,b)}function d(a,b){a.each(function(a){for(var d=a.attr("data-watch").split(","),f=0,g=d.length;g>f;f++){var j=d[f].split(":");switch(j[0]){case"text":var k=c(j[1],b);-1!=k&&a.html(k);break;case"value":var l=c(j[1],b);-1!=l&&a.html(l);break;case"attr":var l=c(j[2],b);-1!=l&&a.attr(j[1],l);break;case"style":var l=c(j[2],b);if(-1!=l)switch(j[1]){case"left":case"right":case"top":case"bottom":case"width":case"height":case"paddingLeft":case"paddingRight":case"paddingTop":case"paddingBottom":case"marginLeft":case"marginRight":case"marginTop":case"marginBottom":a.css(j[1],l+"px");break;default:a.css(j[1],l)}break;case"class":var m=c(j[1],b);-1!=m&&(j[2]?"rm"==j[2]?a.removeClass(m):(a[0].className=a[0].className.replace(/state-[^\s]*[\s]?/gi,"").replace(/(\s)+/gi,"$1"),a.hasClass(m)||a.addClass(m)):a.addClass(m));break;case"part":var n=j[1],o=j[2],p=e(i(n).html());h[n]=p,i(o).html(b?p(b):p)}}})}function e(a){var b=[];b=a.match(/<%=include\(([^)]*)\)=%>/gi)||[];for(var c=0,d=b.length;d>c;c++)b[c]=b[c].replace("<%=include(","").replace(")=%>",""),a=i("#"+b[c])[0]?a.replace(/<%=include\(([^)]*)\)=%>/i,i("#"+b[c]).html()):a.replace(/<%=include\(([^)]*)\)=%>/i,"");var e=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g,"").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return e}function f(a,b,c,d){var f=a.html(),g=e(f,c);b.html(c?g(c):g),d&&d(g)}function g(a,b,c){var e=a.attr("id")||"nocache";if(h[e]){var g=b.all(".node-watch");g.length<1?b.html(c?h[e](c):h[e]):d(g,c)}else f(a,b,c,function(a){h[e]=a})}var h={},i=b.all;return g},{requires:["node"]}),KISSY.add("widget/time/index",function(){function a(a,b){var c=[];if(a+="","[object String]"!=Object.prototype.toString.call(a))throw new Error("not a string");return a.length<b?c=new Array(b-a.length+1).join("0").concat(a):a}function b(a,b){if(b>=0&&59>=b){b=10>b?"0"+b:""+b;var c=d(a).split("");return c.splice(10,2,b),c=c.join("")}return a}function c(a,b){if(b>=0&&59>=b){b=10>b?"0"+b:""+b;var c=d(a).split("");return c.splice(12,2,b),c=c.join("")}return a}function d(b){var b=b+"";return a(b,14)}function e(a){return 1*d(a).substr(0,4)}function f(a){return 1*d(a).substr(4,2)}function g(a){return 1*d(a).substr(6,2)}function h(a){return 1*d(a).substr(8,2)}function i(a){return 1*d(a).substr(10,2)}function j(a){return 1*d(a).substr(12,2)}function k(a,b){var c=j(b),k=i(b),l=h(b);g(b),f(b),e(b);var m=j(a),n=i(a),o=h(a);g(a),f(a),e(a);var p=0,q=0,r=0;if(3600*l+60*k+m>3600*o+60*n+m)return-1;var s=0,t=0;m-c>=0?p=m-c:(p=m+60-c,s++),n-=s,n-k>=0?q=n-k:(q=n+60-k,t++),o-=t,r=o-l>=0?o-l:o+24-l,10>r&&(r="0"+r),10>q&&(q="0"+q),10>p&&(p="0"+p);var u=r+""+q+p;return d(u)}function l(){var b=new Date;return b.getFullYear()+a(b.getMonth()+1,2)+a(b.getDate(),2)+a(b.getHours(),2)+a(b.getMinutes(),2)+a(b.getSeconds(),2)}return{getHours:h,getMin:i,getSec:j,getYear:e,getMon:f,getDate:g,getLeftTime:k,getNow:l,setMin:b,setSec:c}},{requires:["node","dom","ajax"]}),KISSY.add("widget/countdown/timer",function(a){function b(){for(;d.length;)d.shift()();var a=(new Date).getTime()-b.nextTime,e=1+Math.floor(a/100);a=100-a%100,b.nextTime+=100*e;var f,g,h,i;for(h=0,i=c.length;i>h;h+=2)f=c[h+1],0===f?c[h](e):(f+=2*e-1,g=Math.floor(f/20),g>0&&c[h](g),c[h+1]=f%20+1);setTimeout(b,a)}var c=[],d=[];return b.nextTime=+new Date,b(),{add:function(a,b){d.push(function(){c.push(a),c.push(1e3===b?1:0)})},remove:function(b){d.push(function(){var d=a.indexOf(b,c);-1!==d&&c.splice(a.indexOf(b,c),2)})}}}),KISSY.add("widget/countdown/effect",function(a){var b={normal:{paint:function(){var b,c=this;a.each(c.hands,function(d){d.lastValue!==d.value&&(b="",a.each(c._toDigitals(d.value,d.bits),function(a){b+=c._html(a,"","digital")}),d.node.html(b))})}},slide:{paint:function(){var c,d,e,f,g=this;a.each(g.hands,function(a){if(a.lastValue!==a.value){for(c="",d=a.bits,e=g._toDigitals(a.value,d),f=void 0===a.lastValue?e:g._toDigitals(a.lastValue,d);d--;)c=f[d]!==e[d]?g._html([g._html(e[d],"","digital"),g._html(f[d],"","digital")],"slide-wrap")+c:g._html(e[d],"","digital")+c;a.node.html(c)}}),b.slide.afterPaint.apply(g)},afterPaint:function(){a.each(this.hands,function(a){if(a.lastValue!==a.value&&void 0!==a.lastValue){var b=a.node,c=b.one(".digital").height();b.css("height",c),b.all(".slide-wrap").css("top",-c).animate("top: 0",.3,"bounceOut")}})}},flip:{paint:function(){var c,d,e,f=this;a.each(f.hands,function(b){b.lastValue!==b.value&&(c="",d="",e="",a.each(f._toDigitals(b.value,b.bits),function(a){d+=f._html(a,"","digital")}),void 0===b.lastValue?b.node.html(d):(d=f._html(d,"handlet"),a.each(f._toDigitals(b.lastValue,b.bits),function(a){e+=f._html(a,"","digital")}),c=f._html(e,"handlet mask"),e=f._html(e,"handlet"),b.node.html(d+e+c)))}),b.flip.afterPaint.apply(f)},afterPaint:function(){a.each(this.hands,function(a){if(a.lastValue!==a.value&&void 0!==a.lastValue){var b=a.node,c=b.all(".handlet"),d=c.item(0),e=c.item(1),f=c.item(2),g=b.width(),h=b.height(),i=Math.floor(h/2);e.css({clip:"rect("+i+"px, "+g+"px, "+h+"px, 0)"}),f.css({overflow:"hidden",height:i+"px"}),f.animate({top:i+"px",height:0},.15,"easeNone",function(){f.html(d.html()),f.css({top:0,height:i+"px",clip:"rect("+i+"px, "+g+"px, "+h+"px, 0)"}),f.animate("height: "+h+"px",.3,"bounceOut")})}})}}};return b},{requires:[]}),KISSY.add("widget/countdown/index",function(a,b,c,d,e,f){function g(b){if(!(this instanceof g))return new g(b);if(b.el=a.one(b.el),b.el){var c=b.el.attr("data-config");c&&(c=d.parse(c.replace(/'/g,'"')),b=a.merge(c,b)),g.superclass.constructor.call(this,b),this._init()}}var h="afterPaint";return a.extend(g,c,{_init:function(){var b=this,c=b.get("el"),d=[];b.hands=d,b.frequency=1e3,b._notify=[];var f=c.html(),g=b.get("varRegular");g.lastIndex=0,c.html(f.replace(g,function(a,c){("u"===c||"s-ext"===c)&&(b.frequency=100);var e="";return"s-ext"===c?(d.push({type:"s"}),d.push({type:"u"}),e=b._html("","s","handlet")+b._html(".","","digital")+b._html("","u","handlet")):d.push({type:c}),b._html(e,c,"hand")}));var h=b.get("clock");a.each(d,function(a){var b,d=a.type,e=100;for(a.node=c.one(".hand-"+d),b=h.length-3;b>-1&&d!==h[b];b-=3)e*=h[b+1];a.base=e,a.radix=h[b+1],a.bits=h[b+2]}),b._getLeft(),b._reflow();var i=b._reflow;b._reflow=function(){return i.apply(b,arguments)},e.add(b._reflow,b.frequency),c.show()},_getLeft:function(){var b=1e3*this.get("leftTime"),c=this.get("stopPoint");!b&&c&&(b=c-a.now()),this.left=b-b%this.frequency},_reflow:function(b){b=b||0;var c=this;return c.left=c.left-c.frequency*b,a.each(c.hands,function(a){a.lastValue=a.value,a.value=Math.floor(c.left/a.base)%a.radix}),c._repaint(),c._notify[c.left]&&a.each(c._notify[c.left],function(a){a.call(c)}),c.left<1&&e.remove(c._reflow),c},_repaint:function(){f[this.get("effect")].paint.apply(this),this.fire(h)},_toDigitals:function(a,b){a=0>a?0:a;for(var c=[];b--;)c[b]=a%10,a=Math.floor(a/10);return c},_html:function(b,c,d){switch(a.isArray(b)&&(b=b.join("")),d){case"hand":c=d+" hand-"+c;break;case"handlet":c=d+" hand-"+c;break;case"digital":c="."===b?d+" "+d+"-point "+c:d+" "+d+"-"+b+" "+c}return'<s class="'+c+'">'+b+"</s>"},notify:function(a,b){a=1e3*a,a-=a%(this.frequency||1e3);var c=this._notify[a]||[];return c.push(b),this._notify[a]=c,this}},{ATTRS:{el:{},stopPoint:{},leftTime:{value:0},template:{},varRegular:{value:/\$\{([\-\w]+)\}/g},clock:{value:["d",100,2,"h",24,2,"m",60,2,"s",60,2,"u",10,1]},effect:{value:"normal"}}}),g},{requires:["node","base","json","./timer","./effect","./index.css"]}),KISSY.add("page/module-today",function(a,b,c,d,e,f,g){function h(a){function b(a){var b=i(".round-title").all(".time-tips"),c=f.getHours(a),d=f.getMin(a);b.each(function(b){var e=1*b.attr("data-time"),h=0;if(!e)throw new Error("countdown has no data-time");if(c==e-1&&d>=30){if(h=3600-(60*f.getMin(a)+f.getSec(a)),b[0]&&b[0]._countdown)return b[0]._countdown.left=1e3*h,void 0;var i=new g({el:b,effect:"slide",leftTime:h});i.notify(0,function(){var a=i.get("el");a.hide(),this.left=0}),b[0]&&!b[0]._countdown&&(b[0]._countdown=i)}})}function c(a){try{var b=0,c=f.getHours(a),d=f.getMin(a),e=f.getSec(a);i("#qp-goods .scroll-tips").each(function(a){if("none"!=i(a).css("display")&&"hidden"!=i(a).css("visibility")){var f=a.all(".scroll-time"),h=1*a.attr("data-showtime"),j=a.all(".scroll-discount");if(c==h-1&&d>=55)f.attr("data-discount",6),b=3600-60*d-e;else{if(!(c==h&&30>d))return b=0,void 0;var k=Math.floor(d/5);if(b=60*(5*(k+1)-d-1)+(60-e),0!=5-k)f.attr("data-discount",5-k),j.all("em").html(5-k);else{if(0!=5-k)return f._countdown.left=0,a.remove(),void 0;j.html("\u7ed3\u675f")}}if(f[0]&&f[0]._countdown)return f[0]._countdown.left=1e3*b,void 0;var l=new g({el:f,leftTime:b});f[0]&&(f[0]._countdown=l),l.notify(0,function(){var a=this.get("el"),b=1*a.attr("data-discount");b-=1,5==b&&a.parent(".item-info").removeClass("state-soon-now").addClass("state-now"),b?(a.attr("data-discount",b),a.parent(".scroll-tips").all(".scroll-discount").all("em").html(b),this.left=3e5):0==b?(a.attr("data-discount",b),a.parent(".scroll-tips").all(".scroll-discount").html("\u7ed3\u675f"),this.left=3e5):this.left=0})}})}catch(h){console.log(h)}}function h(a){function b(a,b){var c=Math.floor(b/10);return c>=5&&(c=6),7*a+c+1}function c(a,c,d){var e=b(a,c),f=8.5*((d+"").length+3)+30;return e>f-20&&210>e+(f-20)?e-20:f-20>=e?0:210-f}var d=a.systemTime,e=f.getHours(d),g=f.getMin(d),h=f.getSec(d),i=f.getHours(a.showTime);1*a.currentPrice&&(a.currentPrice=(1*a.currentPrice).toFixed(2));var j=[10,15,20];a.left=0,a.leftTime=0,a.discount=6,a.priceLeft=0,a.tipsLeft="state-scroll-tips-left",a.showhours=i,a.currentClass="";for(var k=0;k<j.length;k++)j[k]==i&&(e>=j[k]?e==j[k]&&30>g?(a.discount=6-Math.floor(g/5),a.left=b(g,h),a.priceLeft=c(g,h,a.currentPrice),a.currentClass=0==a.stockCount?"state-later":"state-now",a.left>=100&&(a.tipsLeft="state-scroll-tips-right")):a.currentClass="state-over":e<j[k]&&(a.currentClass=e==j[k]-1&&g>=55?"state-soon-now":"state-soon"));return a.discountC=a.discount-1,"state-soon"!=a.currentClass&&"state-soon-now"!=a.currentClass||!a.discount||6!=a.discount||(a.currentPrice=Math.round(.6*a.currentPrice).toFixed(2)),a}function l(a){var b=a.systemTime||f.getNow(),c={},d={},e={};if(c.data=[],d.data=[],e.data=[],a&&a.data){for(var g=0,i=a.data.length;i>g;g++){var j=a.data[g];switch(j.systemTime||(j.systemTime=b||0),j=h(j),f.getHours(j.showTime)){case 10:c.data.push(a.data[g]);break;case 15:d.data.push(a.data[g]);break;case 20:e.data.push(a.data[g])}}return{tab10:c,tab15:d,tab20:e}}}function m(d){var g=i("#qp-goods"),h=i("#goods-round-10"),k=i("#goods-round-15"),m=i("#goods-round-20"),q=i("#tpl-today-goods"),r=d.systemTime||f.getNow(),s=f.getHours(r);f.getHours(r),f.getHours(r),12>s?g.prepend(h):s>=12&&17>s?(g.prepend(m),g.prepend(k)):g.prepend(m),d=l(d);try{e(q,h.all(".goods-list"),d.tab10),e(q,k.all(".goods-list"),d.tab15),e(q,m.all(".goods-list"),d.tab20)}catch(t){console.log(t)}i("#qp-goods .goods-round").show(),c(r),o(r),b(r),a&&a(),j=setTimeout(function(){n(function(a){p(a)})},5e3)}function n(a,b){if(k){k=!1;var c=JSON_URL_TODAY+"?t="+(new Date).getTime();b&&(c=JSON_URL_GET+"?t="+(new Date).getTime());try{d.jsonp(c,function(b){k=!0,window.TBQP.oldTime||(window.TBQP.oldTime=b.systemTime||f.getNow());var c=f.getMin(window.TBQP.oldTime),d=f.getSec(window.TBQP.oldTime),e=f.getMin(b.systemTime),g=f.getSec(b.systemTime);if(60*e+g>=60*c+d)window.TBQP.oldTime=b.systemTime;else{console.log(window.TBQP.oldTime),console.log(b.systemTime);var h=f.getSec(b.systemTime),i=f.getMin(b.systemTime);h+=5,h>59?(h-=60,i+=1,b.systemTime=f.setSec(b.systemTime,h),b.systemTime=f.setMin(b.systemTime,i)):b.systemTime=f.setSec(b.systemTime,h)}a&&a(b)})}catch(e){console.log(e)}}}function o(a){var b=f.getHours(a),c=f.getMin(a),d=i(".goods-round"),e=i("#goods-round-10 .title-status"),g=i("#goods-round-15 .title-status"),h=i("#goods-round-20 .title-status");d.all(".status-soon").removeClass("status-soon"),d.all(".status-now").removeClass("status-now"),d.all(".status-over").removeClass("status-over"),10>b&&e.addClass("status-soon"),15>b&&g.addClass("status-soon"),20>b&&h.addClass("status-soon"),10==b&&30>c?e.addClass("status-now"):15==b&&30>c?g.addClass("status-now"):20==b&&30>c&&h.addClass("status-now"),(b>10||10==b&&c>=30)&&e.addClass("status-over"),(b>15||15==b&&c>=30)&&g.addClass("status-over"),(b>20||20==b&&c>=30)&&h.addClass("status-over"),d.all(".title-status").html("\u5f00\u62a2"),d.all(".status-over").html("\u62a2\u62cd\u5df2\u7ed3\u675f\uff0c\u4f18\u60e0\u8fdb\u884c\u4e2d"),d.all(".status-soon").html("\u5373\u5c06\u5f00\u59cb"),d.all(".status-now").html("\u6b63\u5728\u62a2\u62cd")}function p(a){var d=a.systemTime||f.getNow();o(d),b(d);var g=i("#goods-round-10"),h=i("#goods-round-15"),k=i("#goods-round-20"),m=i("#tpl-today-goods");a=l(a);try{e(m,g.all(".goods-list"),a.tab10),e(m,h.all(".goods-list"),a.tab15),e(m,k.all(".goods-list"),a.tab20)}catch(q){console.log(q)}c(d),j=setTimeout(function(){n(function(a){p(a)})},5e3)}n(function(a){m(a)})}var i=b.all,j=0,k=!0;return{init:h}},{requires:["node","dom","ajax","widget/tmpl/index","widget/time/index","widget/countdown/index"]}),KISSY.add("widget/localstorage/index",function(a){function b(){h=localStorage,i=function(a,b){h.setItem(a,b)},j=function(a){return h.getItem(a)},k=function(a){h.removeItem(a)},l=function(){h.clear()}}function c(){var a="IELocalDataStore";d(),i=function(b,c){try{h.setAttribute(b,c),h.save(a)}catch(d){}},j=function(b){try{return h.load(a),h.getAttribute(b)}catch(c){}},k=function(b){try{h.removeAttribute(b),h.save(a)}catch(c){}},l=function(){try{h.expires=f(),h.save(a),e()}catch(b){}}}function d(){var a=document;h=a.createElement("link"),h.addBehavior&&(h.style.behavior="url(#default#userData)",a.getElementsByTagName("head")[0].appendChild(h))}function e(){if(h)try{document.body.removeChild(h)}catch(a){}d()}function f(){var a=new Date;return a.setMinutes(a.getMinutes()-1),a.toUTCString()}function g(){"undefined"!=typeof localStorage?b():a.UA.ie<8&&c()}var h,i,j,k,l;g();var m={setItem:i,getItem:j,removeItem:k,clear:l};return m},{requires:["ua"],attach:!1}),KISSY.add("page/module-test",function(a,b,c,d){function e(){var a="http://a.tbcdn.cn/s/fdc/xwj.js";KISSY.getScript(a,function(){g()})}function f(a,b){return Math.floor(Math.random()*(b+1-a))+a}function g(){var a=h(".btn-privilege-buy"),b=f(0,1),c=d.getItem("qb_ab_test");c&&(b=c),0==b?(c||d.setItem("qb_ab_test",0),a.addClass("btn-privilege-buy-red"),a.on("click",function(){window._ap_xwj&&_ap_xwj.monitor("131008-255")})):1==b&&(c||d.setItem("qb_ab_test",1),a.addClass("btn-privilege-buy-gray"),a.on("click",function(){window._ap_xwj&&_ap_xwj.monitor("131008-256")}))}var h=b.all;return{init:e}},{requires:["node","ajax","widget/localstorage/index"]}),KISSY.add("common/reset",function(a,b,c){function d(){var a=c.viewportWidth();a>1260?h("body").addClass("w1190"):h("body").addClass("w990")}function e(){}function f(){KISSY.ready(function(){})}function g(){e(),d(),f()}var h=b.all;return{init:g}},{requires:["node","dom","event"]}),KISSY.add("page/index",function(a,b,c,d){KISSY.ready(function(){try{d.init(),b.init(function(){c.init()})}catch(a){console.log(a)}})},{requires:["page/module-today","page/module-test","common/reset"]});